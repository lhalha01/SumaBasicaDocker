name: Mirror to Azure DevOps

on:
  push:
    branches:
      - '**'

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fetch all branches
        run: git fetch --all

      - name: Push mirror to Azure DevOps
        env:
          ADO_PAT: ${{ secrets.ADO_PAT }}
        run: |
          set -euo pipefail

          ADO_URL="https://${ADO_PAT}@dev.azure.com/STAFFLABS/LabsDevops/_git/SumaBasicaDocker"

          git remote add ado "$ADO_URL" 2>/dev/null || \
            git remote set-url ado "$ADO_URL"

          # --all + --tags: sincroniza ramas y tags sin borrar ramas en ADO
          git push ado --all
          git push ado --tags
